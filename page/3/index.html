<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-79205503-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>구구구구구구구</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Back Street Assassin Cat">
<meta property="og:type" content="website">
<meta property="og:title" content="구구구구구구구">
<meta property="og:url" content="https://ohseunghyeon.github.io/page/3/index.html">
<meta property="og:site_name" content="구구구구구구구">
<meta property="og:description" content="Back Street Assassin Cat">
<meta property="og:locale" content="ko">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="구구구구구구구">
<meta name="twitter:description" content="Back Street Assassin Cat">
  
    <link rel="alternate" href="/atom.xml" title="구구구구구구구" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">구구구구구구구</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">비둘기를 올린다.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://ohseunghyeon.github.io"></form>
      </div>
    </div>
  </div>
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-node-js로-페이스북-챗봇-만들기-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/" class="article-date">
  <time datetime="2018-04-01T11:55:53.000Z" itemprop="datePublished">2018-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/chatbot/">chatbot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/">node.js로 페이스북 챗봇 만들기 6</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="목차"><a href="#목차" class="headerlink" title="목차"></a>목차</h2><ol>
<li><a href="/2018/03/20/node-js로-페이스북-챗봇-만들기-1/">서문</a></li>
<li><a href="/2018/03/21/node-js로-페이스북-챗봇-만들기-2/">개발을 하기 위한 환경 준비</a><ul>
<li>node.js</li>
<li>Visual Studio Code</li>
<li>ngrok</li>
</ul>
</li>
<li><a href="/2018/03/22/node-js로-페이스북-챗봇-만들기-3">node.js로 기본적인 서버 만들기</a><ul>
<li><a href="/2018/03/22/node-js로-페이스북-챗봇-만들기-3">hello world</a></li>
<li><a href="/2018/03/24/node-js로-페이스북-챗봇-만들기-4">HTTP 서버 만들기</a></li>
<li><a href="/2018/03/29/node-js로-페이스북-챗봇-만들기-5">HTTP 서버 요청 핸들링</a></li>
</ul>
</li>
<li><a href="/2018/04/01/node-js로-페이스북-챗봇-만들기-6">facebook messenger와 서버 연동하기</a></li>
<li>AWS lambda에 올리기</li>
</ol>
<h1 id="4-facebook-messenger와-서버-연동하기"><a href="#4-facebook-messenger와-서버-연동하기" class="headerlink" title="4. facebook messenger와 서버 연동하기"></a>4. facebook messenger와 서버 연동하기</h1><p>페이스북 메신저와 연동하기 위해서는 먼저 페이스북에 페이지를 하나 만드셔야 합니다.</p>
<p><a href="https://www.facebook.com/pages" target="_blank" rel="noopener">페이스북 페이지</a>에 접속하셔서 페이지 만들기를 진행해주세요. 당연히 페이스북 아이디가 있으실 거라 믿습니다. 그렇지 않고서야 이 글을 여기까지 읽지 않으셨을 거라고 믿으니까요.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/page_category.PNG" title="페이지 만들기에 접속한 모습">
<p>유형을 선택할 수 있네요. 아무거나 하세요. 솔직히 무슨 상관이겠어요. 하고 싶은 걸 하세요. 페이지를 만드신 후엔 페이스북 개발자 페이지로 가야 합니다.</p>
<p><a href="https://developers.facebook.com/" target="_blank" rel="noopener">페이스북 개발자 페이지</a>를 여세요.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/facebook_developer.PNG" title="페이스북 개발자 페이지에 접속한 모습">
<p>우측 상단에 “내 앱”이든 다른 아이든 눌러주세요. 그리고 “새 앱 추가”를 눌러주세요.</p>
<p>아래와 같은 창이 당신의 모니터에서 떴기를 바랍니다. </p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/new_app.PNG" title="새 앱 추가">
<p>앱의 이름, 연락처를 입력하세요. 앱 이름은 “테스트 앱” 등 마음대로 하셔도 됩니다. 이름이 왜 앱인지는 저도 잘 모르겠습니다. 이 시스템을 이해하기에 좀 덜 직관적이라는 생각이 들더군요. 만드신 앱은 앞서 만든 facebook page와 연동됩니다. 그리고 <strong>“그 facebook page의 메신저에 사용자가 입력한 메시지”</strong>를 받아오기 위한 <strong>“서버 url”</strong>(예, <a href="http://localhost:1337" target="_blank" rel="noopener">http://localhost:1337</a>) 또한 추가할 것입니다.</p>
<p>아래는 방금 만든 앱의 대시보드입니다. 이 앱은 messenger 기능을 사용할 것이므로 아래 사진에서는 “제품 추가” 하단에 있는 Messenger 부분의 “설정 버튼”을 누르십시오.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/app_dashboard.PNG" title="앱 대시보드">
<p>아래와 같이 <strong>좌측에 있는 제품</strong> 이라는 부분에 Messenger와 Webhooks가 추가되었으며 Messenger 설정 화면에는 <strong>1. 토큰 생성</strong>과 <strong>2. Webhooks</strong>가 있습니다.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/messenger_setting.PNG" title="메신저 관련 세팅">
<p><strong>1. 토큰 생성</strong>에서 페이지 선택을 눌러보시면 방금 만든 페이지가 나올 것입니다. 선택해 주세요. 그럼 페이지 액세스 토큰이라는 게 생성됩니다. 이 토큰은 이후 챗봇 서버가 답장할 페이지를 구별하기 위해 사용됩니다.</p>
<p>이에 대한 자세한 설명은 이후에 하겠습니다.</p>
<p><strong>2. Webhooks</strong></p>
<p>webhooks은 web과 hook의 결합 명사의 복수 형태 보입니다. hook은 말 그대로 고리 입니다. 후크 선장 손 대신 쓰는 그거요. 왜 webhook인지는 저도 모르겠습니다(이름이 그런 걸 어쩌라고). 여러분의 서버 주소를 갈고리로 걸어놓고 어떤 이벤트가 일어날 때 그 갈고리가 걸려있는 서버에도 뭔가 알림이나 정보를 보냅니다. 마치 이메일을 보낼 때 CC로 다른 사람 추가해서 보내는 거랑 비슷한 겁니다.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/webhook.PNG" title="웹훅. 그거슨 난관">
<p>콜백 URL이라고 되어 있네요. 여기 당신의 서버 주소를 적어주시면 됩니다. 그런데 http가 아니라 https 서버여야 합니다. https 서버를 만드는 법은 쉽습니다. 앞서서 http 서버를 만드셨죠. require할 때 https를 require 하시고 createServer 함수를 실행하면 https 서버가 완성됩니다. 근데 거기에 더해서 도메인(naver.com, daum.net 같은 거)과 https를 위한 인증서가 필요합니다.</p>
<p>뭘까요? 사실 HTTPS 서버는 만들기 어렵습니다.. 쉽지 않아요. 그렇다고 여기서 HTTPS 서버 만들기를 할 수는 없어요. 그렇게 되면 글의 핀트가 너무도 어긋나게 됩니다. 그래서 필요한 게 앞서 다운받은 <a href="https://ngrok.com/" target="_blank" rel="noopener">ngrok</a>입니다. 얘 홈피에서 가입 하시고 다운로드 받으셔야 해요.</p>
<p>얘는 https 서버를 쉽게 생성할 수 있도록 도와줍니다. 시도해봅시다.</p>
<p>cmd를 열어 <em>ngork.exe</em>가 있는 곳으로 가줍니다. 그리고 다음과 같이 입력하세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngrok.exe http 1337</span><br></pre></td></tr></table></figure>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/ngrok_on_cmd.PNG" title="ngrok 실행 명령어">
<p>다음은 실행 후 화면입니다.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/ngrok_http.PNG" title="ngrok 실행 후">
<p>위에 노랗게 칠해진 부분이 보이세요?</p>
<p><em><a href="https://f1ade660.ngrok.io" target="_blank" rel="noopener">https://f1ade660.ngrok.io</a></em> 라는 주소가 보입니다. 이 주소로 접속하면 localhost(사용자 컴퓨터)의 1337 포트로 포워딩을 해줍니다. 즉 위의 webhooks 콜백 URL에 이 주소를 입력하면 https 서버를 따로 구축할 필요 없이 개발을 할 수 있게 됩니다.</p>
<p>그럼 다음과 같이 넣으면 됩니다.</p>
<img src="/2018/04/01/node-js로-페이스북-챗봇-만들기-6/after_inserted_callbackURL.PNG" title="callback url을 입력한 후">
<p>그럼 이제 확인 토큰 부분을 넣어야겠네요. 확인 토큰을 설명하기 위해서는 페이스북 메신저에 붙일 webhook 서버가 어떤 방식으로 동작해야 하는지 먼저 설명해야 합니다.</p>
<p>webhook 서버는 두 가지 기능을 가지고 있어야 합니다.</p>
<ol>
<li><strong>인증</strong></li>
<li><strong>메시지 반환</strong></li>
</ol>
<p>인증은 이 웹훅 서버가 페이스북 메신저와 통신할 수 있는 상태인지 확인하는 절차입니다.</p>
<p>즉 위에서 <em>확인 토큰</em>에 특정 값을 입력하면 이 토큰 값이 Webhook 서버로 옵니다. 그럼 webhook 서버에서 이를 확인하고 옳바른 값을 반환하면 webhook 설정을 완료할 수 있게 됩니다.</p>
<p>두 번째로 메시지 반환은 앞서 설명한 대로 메신저에서 유저가 입력한 값이 오면 이에 알맞은 답변을 반환하는 겁니다.</p>
<p>이 두 요청은 같은 주소로 오게 됩니다. 즉 <a href="https://f1ade660.ngrok.io라는" target="_blank" rel="noopener">https://f1ade660.ngrok.io라는</a> 주소로 오게 되는데요. 이 때, 1. 인증의 경우는 GET이라는 Method를, 2. 메시지 관련 요청은 POST라는 Method로 HTTP 요청이 옵니다.</p>
<p>뜬금 없지만 먼저 HTTP가 어떤 내용으로 오고 가는지 봐야겠습니다.<br>다음은 <a href="https://ko.wikipedia.org/wiki/HTTP" target="_blank" rel="noopener">위키피디아 HTTP 페이지</a>에 나와 있는 HTTP 클라이언트 요청과 서버 응답의 예시입니다.</p>
<p>클라이언트 요청<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1</span><br><span class="line">Host: www.example.com</span><br><span class="line"></span><br><span class="line">Every interaction is both precious and an opportunity to delight.</span><br></pre></td></tr></table></figure></p>
<p>HTTP 메시지는 크게 네 부분으로 나뉩니다. 위의 line number로 설명하겠습니다.</p>
<ol>
<li>요청줄</li>
<li>헤더</li>
<li>공백</li>
<li>기타 메시지</li>
</ol>
<p>Method(요청 방식)란 HTTP 라는 프로토콜을 보낼 때 해당 메시지가 갖고 있는 동작에 대한 규약입니다. Method는 OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT, PATCH 가 있습니다. 이는 첫 번째 라인인 <strong>요청줄</strong>의 가장 앞 부분에 나옵니다.</p>
<p>페이스북 메신저가 webhook 서버로 보내는 요청 Method는 GET과 POST 둘로 한정됩니다. 앞서 서술한 것처럼 GET은 서버가 살아 있는지, 인증 토큰은 동일한지 확인하기 위해 사용되며 POST는 사용자가 챗봇에 입력한 메시지를 보내주기 위해 사용합니다.</p>
<p>이런 method는 특정 역할이 뚜렷하게 정해진 것은 아닙니다. GET은 <strong>4. 기타 메시지</strong>를 포함할 수 없고 POST는 포함할 수 있습니다. 그래서 페이스북 메신저는 <strong>4. 기타 메시지</strong>에 사용자가 입력한 메시지를 포함하여 보내기 위해 POST를 <em>메시지 보내기</em> 용도로 사용하고 GET을 인증으로 사용하는 것으로 생각됩니다.</p>
<p>GET method는 크롬이나 기타 브라우저의 주소창에 주소를 치고 엔터를 칠 때 사용되는 method입니다. 즉 가장 많이 사용되는 method입니다. 그저 해당 서버에 특정 path에 해당하는 정보를 받아오기 위해 사용합니다.</p>
<p>위의 <strong>1. 요청줄</strong> 에서, path는 method의 바로 다음에 있는 <strong>/index.html</strong> 입니다. 이 주소는 <strong><a href="http://www.example.com/index.html" target="_blank" rel="noopener">www.example.com/index.html</a></strong>과 같이 절대 경로가 되어도 됩니다. 만약 네이버 페이지에 접속한다고 하면 HTTP 메시지는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET http://www.naver.com HTTP/1.1</span><br><span class="line"></span><br><span class="line">또는</span><br><span class="line"></span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: www.naver.com</span><br></pre></td></tr></table></figure>
<p><em>Host: <a href="http://www.naver.com" target="_blank" rel="noopener">www.naver.com</a></em> 는 <strong>2. 헤더</strong>에 해당하는 부분입니다. 헤더는 다양한 내용을 포함합니다. 유저가 사용하는 클라이언트의 종류, 언어, 기타 메시지에 포함된 내용의 형식 등이 그 예입니다.</p>
<p>아래는 클라이언트 요청에 대한 서버의 응답입니다.</p>
<p>서버 응답<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 23 May 2005 22:38:34 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Content-Encoding: UTF-8</span><br><span class="line">Content-Length: 138</span><br><span class="line">Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT</span><br><span class="line">Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)</span><br><span class="line">ETag: &quot;3f80f-1b6-3e1cb03b&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;title&gt;An Example Page&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    Hello World, this is a very simple HTML document.</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>그럼 HTTP에 대한 개념을 조금 알아봤으니 이를 node.js 서버에서 구현해야겠지요.</p>
<p><a href="/2018/04/22/node-js로-페이스북-챗봇-만들기-7">node.js로 페이스북 챗봇 만들기 7</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohseunghyeon.github.io/2018/04/01/node-js로-페이스북-챗봇-만들기-6/" data-id="cjhr84imq000lycvffycjvlf3" class="article-share-link">공유</a>
      
        <a href="https://ohseunghyeon.github.io/2018/04/01/node-js로-페이스북-챗봇-만들기-6/#disqus_thread" class="article-comment-link">댓글</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws-lambda/">aws lambda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chatbot/">chatbot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/facebook-messenger/">facebook messenger</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/챗봇/">챗봇</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-이상한-꿈" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/31/이상한-꿈/" class="article-date">
  <time datetime="2018-03-31T01:59:52.000Z" itemprop="datePublished">2018-03-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/일기/">일기</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/31/이상한-꿈/">이상한 꿈</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>악몽을 꿨다.<br>주변에 내 또래로 보이는 친구들이 많다.<br>그리고 밖으로 나가서 열심히 뛰어다녔다.<br>나와 이 친구들을 잡으러 다니는 것들이 생긴다.<br>도망치려고 달린다. 건물 외벽도 막 오른다.(파쿠르?)</p>
<p>한참을 도망치다가 깼다..<br>왜 이런 꿈을 꿨지 생각해 본다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohseunghyeon.github.io/2018/03/31/이상한-꿈/" data-id="cjhr84imq000qycvfcc6alpdz" class="article-share-link">공유</a>
      
        <a href="https://ohseunghyeon.github.io/2018/03/31/이상한-꿈/#disqus_thread" class="article-comment-link">댓글</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-node-js로-페이스북-챗봇-만들기-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/29/node-js로-페이스북-챗봇-만들기-5/" class="article-date">
  <time datetime="2018-03-29T01:08:13.000Z" itemprop="datePublished">2018-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/chatbot/">chatbot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/29/node-js로-페이스북-챗봇-만들기-5/">node.js로 페이스북 챗봇 만들기 5</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="목차"><a href="#목차" class="headerlink" title="목차"></a>목차</h2><ol>
<li><a href="/2018/03/20/node-js로-페이스북-챗봇-만들기-1/">서문</a></li>
<li><a href="/2018/03/21/node-js로-페이스북-챗봇-만들기-2/">개발을 하기 위한 환경 준비</a><ul>
<li>node.js</li>
<li>Visual Studio Code</li>
<li>ngrok</li>
</ul>
</li>
<li><a href="/2018/03/22/node-js로-페이스북-챗봇-만들기-3">node.js로 기본적인 서버 만들기</a><ul>
<li><a href="/2018/03/22/node-js로-페이스북-챗봇-만들기-3">hello world</a></li>
<li><a href="/2018/03/24/node-js로-페이스북-챗봇-만들기-4">HTTP 서버 만들기</a></li>
<li><a href="/2018/03/29/node-js로-페이스북-챗봇-만들기-5">HTTP 서버 요청 핸들링</a></li>
</ul>
</li>
<li><a href="/2018/04/01/node-js로-페이스북-챗봇-만들기-6">facebook messenger와 서버 연동하기</a></li>
<li>AWS lambda에 올리기</li>
</ol>
<h1 id="3-node-js로-기본적인-서버-만들기"><a href="#3-node-js로-기본적인-서버-만들기" class="headerlink" title="3. node.js로 기본적인 서버 만들기"></a>3. node.js로 기본적인 서버 만들기</h1><h2 id="HTTP-서버-요청-핸들링"><a href="#HTTP-서버-요청-핸들링" class="headerlink" title="* HTTP 서버 요청 핸들링"></a>* HTTP 서버 요청 핸들링</h2><p>앞서 HTTP 서버를 만들었어요.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">1337</span>;</span><br><span class="line"></span><br><span class="line">server.listen(port);</span><br></pre></td></tr></table></figure>
<p>이렇게 생겼죠.<br>그런데 얘로 뭘 할 수 있는지 모르겠죠? 그리고 얘가 뭘 하는지도 모르겠고요? 사실은 얘 아무것도 못 합니다. (읭?) 핸들러를 넣어줘야 해요.<br>핸들러는 클라이언트가 요청을 했을 때 그 요청을 어떻게 처리해서 응답을 줄 건지 처리하는 역할을 갖고 있으며 function이 되어야 합니다.</p>
<p>그럼 function은 뭔가요?</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이런 애예요. a, b를 넣으면 둘을 합쳐서 돌려주는 애예요. 수학시간에 배우신 함수와 같은 개념입니다.<br>위의 경우엔 함수를 선언(function declaration)한 것입니다. 이런 함수가 있어요. 하고 알리는 거죠. 그럼 이 함수를 사용할 수 있습니다.<br>이게 필요한 이유는.. 몰라요.<br>제 생각엔 중복의 제거? 추상화? 등이 될 수 있지 않나 싶네요.</p>
<p>위의 코드는 아래와 같이 사용할 수 있어요.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = add(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>sum이라는 변수에 1과 2를 합산한 값을 담아주는 것입니다.</p>
<p>그럼 http 서버의 핸들러는 어떻게 생겨야 할까요</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestHandler</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>요로케 생겨야 합니다.</p>
<p>request와 response라는 애를 받아서 특정 작업을 합니다.<br>request는 우리가 만든 HTTP 서버로 날아온 누군가의 요청과 관련된 데이터가 담긴 object이며,<br>response는 우리가 응답하기 위해 사용할 object입니다. 요청자가 원하는 데이터를 담아서 돌려줄 수 있죠. 이 글에서는 챗봇의 대답을 담아서 돌려주겠죠?</p>
<p>간단한 handler를 구현해 봅시다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestHandler</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>response 객체(object)에게 end라는 함수를 실행하라고 합니다. end는 요청을 다 처리했고 응답을 보내는 아이입니다.<br>위의 경우엔 hello world를 보내주고 있네요.</p>
<p>이렇게 완성된(?) handler를 http.createServer() 에 넣어줘야 해요.<br>http.createServer(requestHandler); 처럼 하시면 됩니다.</p>
<p>완성된 코드를 볼게요.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(requestHandler)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestHandler</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">1337</span>;</span><br><span class="line">server.listen(port);</span><br></pre></td></tr></table></figure>
<p>핸들러 함수를 저렇게 http.createServer에게 인자(argument)로 넘겨줬어요.<br>이렇게 함수를 따로 선언하고 인자로 넘겨줘도 되지만</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> <span class="title">requestHandler</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">1337</span>;</span><br><span class="line">server.listen(port);</span><br></pre></td></tr></table></figure>
<p>이처럼 바로 저 자리에서 선언해서 넣어줘도 됩니다.</p>
<p>이렇게 requestHandler를 넘겨주게 되면 createServer 함수가 requestHandler라는 함수를 내부에 보관하고 있다가<br>request가 들어올 때 requestHandler 함수를 실행합니다. request 인자와 response 인자도 함께요.</p>
<p>이제 실행해보세요. press F5<br><img src="/2018/03/29/node-js로-페이스북-챗봇-만들기-5/server_run.PNG" title="서버 다시 실행"></p>
<p>이제 이 서버를 시도해 볼 수 있습니다.</p>
<p>웹 브라우저를 여시고 아래 주소를 입력하세요</p>
<p><strong><a href="http://localhost:1337" target="_blank" rel="noopener">http://localhost:1337</a></strong></p>
<img src="/2018/03/29/node-js로-페이스북-챗봇-만들기-5/1337.PNG" title="localhost hello world">
<p>서버가 hello world라는 텍스트를 응답으로 줬네요. 예에!</p>
<p>브라우저에서 <a href="http://localhost:1337라는" target="_blank" rel="noopener">http://localhost:1337라는</a> url로 접근하여 hello world라는 text를 얻어왔습니다.</p>
<p>브라우저의 주소창에 주소를 입력하여 접속을 시도하는 행위는 HTTP 요청을 날리는 것입니다. 즉 해당 주소(그 끝엔 서버가 있겠죠)로 가서 걔가 주는 걸 받아오는 것인데요. 이렇게 브라우저가 아니라도 다른 HTTP 클라이언트를 사용하여 동일한 결과를 얻을 수 있습니다.</p>
<p>Postman이라는 클라이언트 프로그램에서 같은 요청과 응답을 볼 수 있습니다.</p>
<img src="/2018/03/29/node-js로-페이스북-챗봇-만들기-5/postman.PNG" title="postman HTTP request http://localhost:1337">
<p>다음은 또 다른 친구인 curl을 사용하여 HTTP 요청과 응답을 가져오는 모습입니다.</p>
<img src="/2018/03/29/node-js로-페이스북-챗봇-만들기-5/curl.PNG" title="curl HTTP request http://localhost:1337">
<p>이렇듯 HTTP를 기반으로 클라이언트가 될 수 있는 프로그램은 많습니다. node.js가 아닌 서버를 만들 수 있는 다른 프로그래밍 언어에서도 이는 쉽게 구현 가능합니다. 그러나 node.js에서 HTTP request를 하는 법은 당장은 귀찮기 때문에 넘어가겠습니다.</p>
<p><a href="/2018/04/01/node-js로-페이스북-챗봇-만들기-6">node.js로 페이스북 챗봇 만들기 6</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ohseunghyeon.github.io/2018/03/29/node-js로-페이스북-챗봇-만들기-5/" data-id="cjhr84ima0007ycvf9sa0kseu" class="article-share-link">공유</a>
      
        <a href="https://ohseunghyeon.github.io/2018/03/29/node-js로-페이스북-챗봇-만들기-5/#disqus_thread" class="article-comment-link">댓글</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws-lambda/">aws lambda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chatbot/">chatbot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/facebook-messenger/">facebook messenger</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/챗봇/">챗봇</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; 이전</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">다음 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/chatbot/">chatbot</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/일기/">일기</a><span class="category-list-count">8</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/GS25/">GS25</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws-lambda/">aws lambda</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chatbot/">chatbot</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facebook-messenger/">facebook messenger</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/단지우유/">단지우유</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/비둘기/">비둘기</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/빙그레/">빙그레</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/연어장/">연어장</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/오디맛/">오디맛</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/챗봇/">챗봇</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/GS25/" style="font-size: 10px;">GS25</a> <a href="/tags/aws-lambda/" style="font-size: 20px;">aws lambda</a> <a href="/tags/chatbot/" style="font-size: 20px;">chatbot</a> <a href="/tags/facebook-messenger/" style="font-size: 20px;">facebook messenger</a> <a href="/tags/node-js/" style="font-size: 20px;">node.js</a> <a href="/tags/단지우유/" style="font-size: 10px;">단지우유</a> <a href="/tags/비둘기/" style="font-size: 15px;">비둘기</a> <a href="/tags/빙그레/" style="font-size: 10px;">빙그레</a> <a href="/tags/연어장/" style="font-size: 10px;">연어장</a> <a href="/tags/오디맛/" style="font-size: 10px;">오디맛</a> <a href="/tags/챗봇/" style="font-size: 20px;">챗봇</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">5월 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">4월 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">3월 2018</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/05/29/한가한-요즘/">한가한 요즘</a>
          </li>
        
          <li>
            <a href="/2018/05/15/역동적인-모닝-비둘기/">역동적인 모닝 비둘기</a>
          </li>
        
          <li>
            <a href="/2018/05/13/마로니에공원-비둘기/">마로니에공원 비둘기</a>
          </li>
        
          <li>
            <a href="/2018/04/22/node-js로-페이스북-챗봇-만들기-7/">node.js로 페이스북 챗봇 만들기 7</a>
          </li>
        
          <li>
            <a href="/2018/04/05/일이-매일-쌓여만-간다/">일이 매일 쌓여만 간다.</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      Total visitor <span id="busuanzi_value_site_uv"></span><br>
      &copy; 2018 SeungHyeon Oh<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'ohseunghyeon';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>